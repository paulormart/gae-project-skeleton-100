!function(){"use strict";angular.module("app",["ngRoute","ngCookies","ngResource","ngAnimate","ui.router","ui.bootstrap","app.core","app.authentication"])}(),function(){"use strict";angular.module("app").config(["$httpProvider","$locationProvider","$resourceProvider",function($httpProvider,$locationProvider,$resourceProvider){$httpProvider.defaults.xsrfHeaderName="X-CSRFToken",$httpProvider.defaults.xsrfCookieName="csrftoken",$locationProvider.html5Mode(!1),$resourceProvider.defaults.stripTrailingSlashes=!1}])}(),function(){"use strict";angular.module("app").constant("ACCESS_LEVELS",{pub:1,user:2}).constant("URLS",{path:{_DASHBOARD_:"/index/main",_SEARCH_:"/search",_LOGIN_:"/login",_SIGNUP_:"/signup",_RESET_PASSWORD_:"/reset-password",_RESET_PASSWORD_CONFIRMATION_:"/reset-password/:key_url/:token",_EMAIL_VERIFICATION_BY_TOKEN_:"/email-verification-by-token/:token"},api:{_LOGIN_:"/api/login/",_LOGOUT_:"/api/logout/",_SIGNUP_:"/api/signup/",_RESET_PASSWORD_:"/api/reset-password/:key_url/",_EMAIL_VERIFICATION_BY_TOKEN_:"/api/email-verification-by-token/:token/",_USER_:"/api/user/:key_url/",_USER_VERIFICATION_:"/api/user-verification/:key_url/"}})}(),function(){"use strict";angular.module("app").config(["$routeProvider","$urlRouterProvider","$stateProvider","ACCESS_LEVELS","URLS",function($routeProvider,$urlRouterProvider,$stateProvider,ACCESS_LEVELS,URLS){$stateProvider.state("login",{url:URLS.path._LOGIN_+"?redirectTo",templateUrl:"static/partial/authentication/login.html",access_level:ACCESS_LEVELS.pub,controller:"LoginController",controllerAs:"ctrl",data:{pageTitle:"Login"}}),$stateProvider.state("signup",{url:URLS.path._SIGNUP_,templateUrl:"static/partial/authentication/signup.html",access_level:ACCESS_LEVELS.pub,controller:"SignupController",controllerAs:"ctrl",data:{pageTitle:"Signup"}}),$stateProvider.state("reset-password",{url:URLS.path._RESET_PASSWORD_,templateUrl:"static/partial/authentication/reset_password.html",access_level:ACCESS_LEVELS.pub,controller:"ResetPasswordController",controllerAs:"ctrl",data:{pageTitle:"Reset password"}}),$stateProvider.state("reset-password-confirmation",{url:URLS.path._RESET_PASSWORD_CONFIRMATION_,templateUrl:"static/partial/authentication/reset_password_confirmation.html",access_level:ACCESS_LEVELS.pub,controller:"ResetPasswordConfirmationController",controllerAs:"ctrl",data:{pageTitle:"Confirm password"}}),$stateProvider.state("index",{"abstract":!0,url:"/index",templateUrl:"static/partial/core/layout.html",access_level:ACCESS_LEVELS.user,controller:"MainController",controllerAs:"ctrl"}),$stateProvider.state("index.search",{url:"/search",templateUrl:"static/partial/core/search.html",access_level:ACCESS_LEVELS.pub,data:{pageTitle:""}}),$stateProvider.state("index.main",{url:"/main",templateUrl:"static/partial/main.html",access_level:ACCESS_LEVELS.user,data:{pageTitle:"Example view 1"}}),$stateProvider.state("index.minor",{url:"/minor",templateUrl:"static/partial/minor.html",access_level:ACCESS_LEVELS.user,data:{pageTitle:"Example view 2"}}),$urlRouterProvider.otherwise("/index/search")}])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function($httpProvider){var interceptor=function($q,$rootScope,MessagingFactory,MESSAGES,SpinnerFactory){var messaging=MessagingFactory,messages=MESSAGES,spinnerFactory=SpinnerFactory,_showSpinner=function(){spinnerFactory.isLoading=!0,$("#spinner").show()},_hideSpinner=function(){spinnerFactory.isLoading=!1,$("#spinner").hide()},_getServerNotifications=function(headers){if(headers.server_messages){var notifications=$.parseJSON(headers.server_messages.replace(/'/g,'"'));_.each(notifications,function(notification){messaging.publish(messages.topic._ADD_NOTIFICATION_,[notification.message,notification.extra_tags])})}};return{request:function(request){return console.log("request>",request),_showSpinner(),$q.when(request)},requestError:function(error){return console.log("requestError>",error),_hideSpinner(),$q.reject(error)},response:function(response){console.log("response>",response);var headers=response.headers();return _getServerNotifications(headers),_hideSpinner(),$q.when(response)},responseError:function(response){switch(console.log("responseError>",response),response.status){case 400:_.each(response.data,function(errors,key){_.each(errors,function(e){console.log("responseError-400>",errors,key,e),messaging.publish(messages.topic._ADD_NOTIFICATION_,[e,"danger"])})}),console.log("case> 400");break;case 401:console.log("case> 401"),"api/login"!==response.config.url&&$rootScope.$broadcast("auth:loginRequired",response.config.url);break;case 403:console.log("case> 403");break;case 404:console.log("case> 404");break;case 500:console.log("case> 500"),messaging.publish(messages.topic._ADD_NOTIFICATION_,["Upps! Internal Server Error!","danger"])}return _hideSpinner(),$q.reject(response)}}};$httpProvider.interceptors.push(interceptor)}])}(),function(){"use strict";angular.module("app.core",["core.animations","core.controllers","core.directives","core.services"])}(),function(){"use strict";angular.module("core.animations",[])}(),function(){"use strict";angular.module("core.controllers",[])}(),function(){"use strict";angular.module("core.controllers").controller("BaseController",["$scope","$location","MessagingFactory","SpinnerFactory","AuthFactory",function($scope,$location,MessagingFactory,SpinnerFactory,AuthFactory){var messaging=MessagingFactory;$scope.spinner=SpinnerFactory,$scope.auth=AuthFactory,$scope.messagingHandles=[],$scope.subscribe=function(topic,callback){var handle=messaging.subscribe(topic,callback);handle&&$scope.messagingHandles.push(handle)},$scope.publish=function(topic,data){messaging.publish(topic,data)},$scope.$on("$destroy",function(){angular.forEach($scope.messagingHandles,function(handle){messaging.unsubscribe(handle)})}),$scope.errorMessage=function(name){var result=[];return _.each($scope.form[name].$error,function(key,value){key&&result.push(value)}),result.join(", ")}}])}(),function(){"use strict";angular.module("core.controllers").controller("MainController",["$scope","$controller","$location","MESSAGES","URLS","UserModel",function($scope,$controller,$location,MESSAGES,URLS,UserModel){var messages=MESSAGES,_self=this;this.userName="Example user",this.helloText="Welcome in SeedProject",this.descriptionText="It is an application skeleton for a typical AngularJS web app. You can use it to quickly bootstrap your angular webapp projects and dev environment for these projects.",$controller("BaseController",{$scope:$scope});var _onAuthenticationCompleted=function(user){_self.user=user},_onLogoutComplete=function(){_self.user=new UserModel,$location.path(URLS.path._SEARCH_)};this.search=function(){console.log("search")},this.onLogin=function(){$location.path(URLS.path._LOGIN_)},this.onLogout=function(){$scope.publish(messages.topic._LOGOUT_USER_)},this.onSettings=function(){console.log("**** TO BE CHANGED ****")};var init=function(){_self.user=$scope.auth.getUser(),$scope.subscribe(messages.topic._AUTHENTICATION_COMPLETED_,_onAuthenticationCompleted),$scope.subscribe(messages.topic._LOGOUT_USER_COMPLETE_,_onLogoutComplete)};init()}])}(),function(){"use strict";angular.module("core.directives",[])}(),function(){"use strict";angular.module("core.directives").directive("minimalizaSidebar",["$timeout",function($timeout){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="" ng-click="minimalize()"><i class="fa fa-bars"></i></a>',controller:function($scope,$element){$scope.minimalize=function(){$("body").toggleClass("mini-navbar"),!$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(500)},100)):$("body").hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(500)},300)):$("#side-menu").removeAttr("style")}}}}])}(),function(){"use strict";angular.module("core.directives").directive("dirModal",["MessagingFactory","MESSAGES",function(MessagingFactory,MESSAGES){return{restrict:"E",replace:!0,templateUrl:"static/partial/core/dir_modal.html",link:function(scope,element){var messaging=MessagingFactory,messages=MESSAGES;element.hide(),scope.modalType="popup",scope.message="";var showPopupHandler=function(messageText){scope.message=messageText,scope.modalType="popup",element.show(),console.log("messageText",messageText,element)},showConfirmationHandler=function(messageText){scope.message=messageText,scope.modalType="confirmation",element.show()};scope.showPopupHandle=messaging.subscribe(messages.topic._MODAL_POPUP_,showPopupHandler),scope.showConfirmationHandle=messaging.subscribe(messages.topic._MODAL_CONFIRMATION_,showConfirmationHandler),scope.$on("$destroy",function(){messaging.unsubscribe(scope.showPopupHandle),messaging.unsubscribe(scope.showConfirmationHandle)}),scope.answeredOk=function(){element.hide(),messaging.publish(messages.topic._MODAL_USER_RESPONSE_,"OK")},scope.answeredYes=function(){element.hide(),messaging.publish(messages.topic._MODAL_USER_RESPONSE_,"YES")},scope.answeredNo=function(){element.hide(),messaging.publish(messages.topic._MODAL_USER_RESPONSE_,"NO")}}}}])}(),function(){"use strict";angular.module("core.directives").directive("dirNotification",["MessagingFactory","MESSAGES",function(MessagingFactory,MESSAGES){var _template='<div class="row"><div class="col-sm-4 col-sm-offset-4"><div class="alert alert-dismissable alert-{{notification.type}} fadeIn" ng-repeat="notification in notifications track by $index"><button type="button" class="close" ng-click="close($index)" aria-hidden="true">&times;</button>{{notification.message}}</div></div></div>';return{restrict:"E",scope:{},template:_template,replace:!0,link:function(scope,element,attrs){var messaging=MessagingFactory,messages=MESSAGES;scope.notifications=[];var _onErrorNotificationUpdated=function(errorMessages){scope.notifications||(scope.notifications=[]),scope.notifications.push(errorMessages),messaging.publish(messages.topic._CLEAR_NOTIFICATIONS_)},_errorNotificationUpdate=messaging.subscribe(messages.topic._ERROR_NOTIFICATION_UPDATED_,_onErrorNotificationUpdated);scope.$on("$destroy",function(){messaging.unsubscribe(_errorNotificationUpdate)}),scope.close=function(index){scope.notifications.splice(index,1)}}}}])}(),function(){"use strict";angular.module("core.directives").directive("dirPageTitle",["$rootScope","$timeout",function($rootScope,$timeout){return{restrict:"A",link:function(scope,element){var listener=function(event,toState,toParams,fromState,fromParams){var title="GAE | Responsive Admin Theme";toState.data&&toState.data.pageTitle&&(title="GAE | "+toState.data.pageTitle),$timeout(function(){element.text(title)})};$rootScope.$on("$stateChangeStart",listener)}}}])}(),function(){"use strict";angular.module("core.directives").directive("sideNavigation",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element){$timeout(function(){element.metisMenu()})}}}])}(),function(){"use strict";angular.module("core.services",[])}(),function(){"use strict";angular.module("core.services").constant("MESSAGES",{topic:{_ADD_NOTIFICATION_:"_ADD_NOTIFICATION_",_CLEAR_NOTIFICATIONS_:"_CLEAR_NOTIFICATIONS_",_ERROR_NOTIFICATION_UPDATED_:"_ERROR_NOTIFICATION_UPDATED_",_SHOW_MODAL_:"_SHOW_MODAL_",_MODAL_POPUP_:"_MODAL_POPUP_",_MODAL_CONFIRMATION_:"_MODAL_CONFIRMATION_",_MODAL_USER_RESPONSE_:"_MODAL_USER_RESPONSE_",_AUTHENTICATION_COMPLETED_:"_AUTHENTICATION_COMPLETED_",_AUTHENTICATION_FAILED_:"_AUTHENTICATION_FAILED_",_LOGIN_USER_:"_LOGIN_USER_",_LOGIN_USER_COMPLETE_:"_LOGIN_USER_COMPLETE_",_LOGIN_USER_FAILED_:"_LOGIN_USER_FAILED_",_SIGNUP_USER_:"_SIGNUP_USER_",_SIGNUP_USER_COMPLETE_:"_SIGNUP_USER_COMPLETE_",_SIGNUP_USER_FAILED_:"_SIGNUP_USER_FAILED_",_LOGOUT_USER_:"_LOGOUT_USER_",_LOGOUT_USER_COMPLETE_:"_LOGOUT_USER_COMPLETE_",_LOGOUT_USER_FAILED_:"_LOGOUT_USER_FAILED_",_COOKIES_SIGNIN_:"_COOKIES_SIGNIN_",_COOKIES_SIGNIN_COMPLETED_:"_COOKIES_SIGNIN_COMPLETED_",_COOKIES_SIGNIN_FAILED_:"_COOKIES_SIGNIN_FAILED_",_GET_RESET_PASSWORD_:"_GET_RESET_PASSWORD_",_GET_RESET_PASSWORD_COMPLETE_:"_GET_RESET_PASSWORD_COMPLETE_",_GET_RESET_PASSWORD_FAILED_:"_GET_RESET_PASSWORD_FAILED_",_RESET_PASSWORD_:"_RESET_PASSWORD_",_RESET_PASSWORD_COMPLETE_:"_RESET_PASSWORD_COMPLETE_",_RESET_PASSWORD_FAILED_:"_RESET_PASSWORD_FAILED_",_RESET_PASSWORD_CONFIRMATION_:"_RESET_PASSWORD_CONFIRMATION_",_RESET_PASSWORD_CONFIRMATION_COMPLETE_:"_RESET_PASSWORD_CONFIRMATION_COMPLETE_",_RESET_PASSWORD_CONFIRMATION_FAILED_:"_RESET_PASSWORD_CONFIRMATION_FAILED_"}})}(),function(){"use strict";angular.module("core.services").factory("MessagingFactory",[function(){var cache={},_subscribe=function(topic,callback){return cache[topic]||(cache[topic]=[]),cache[topic].push(callback),[topic,callback]},_publish=function(topic,args){cache[topic]&&angular.forEach(cache[topic],function(callback){callback.apply(null,args||[])})},_unsubscribe=function(handle){var t=handle[0];if(cache[t])for(var x=0;x<cache[t].length;x++)cache[t][x]===handle[1]&&cache[t].splice(x,1)},api={publish:_publish,subscribe:_subscribe,unsubscribe:_unsubscribe};return api}])}(),function(){"use strict";angular.module("core.services").factory("ModalFactory",["$timeout","MessagingFactory","MESSAGES",function($timeout,MessagingFactory,MESSAGES){var messaging=MessagingFactory,messages=MESSAGES,_messageText="",_displayType="popup",_displayDialogHandler=function(message,type){_messageText=message,_displayType=type,$timeout(function(){switch(_displayType){case"popup":messaging.publish(messages.topic._MODAL_POPUP_,[_messageText]);break;case"confirmation":messaging.publish(messages.topic._MODAL_CONFIRMATION_,[_messageText]);break;default:messaging.publish(messages.topic._MODAL_POPUP_,[_messageText])}},0)};messaging.subscribe(messages.topic._SHOW_MODAL_,_displayDialogHandler);var init=function(){_messageText="",_displayType="popup"},api={init:init};return api}])}(),function(){"use strict";angular.module("core.services").factory("ModelTransformerFactory",function(){var _transformObject=function(jsonResult,constructor){var model=new constructor;return angular.extend(model,jsonResult),model},_transformResult=function(jsonResult,constructor){if(angular.isArray(jsonResult)){var models=[];return angular.forEach(jsonResult,function(object){models.push(_transformObject(object,constructor))}),models}return _transformObject(jsonResult,constructor)},api={transform:_transformResult};return api})}(),function(){"use strict";angular.module("core.services").factory("NotificationFactory",["$timeout","MessagingFactory","MESSAGES",function($timeout,MessagingFactory,MESSAGES){var messaging=MessagingFactory,messages=MESSAGES,_notifications=[],_addNotification=function(message,type){_notifications||(_notifications=[]),_notifications.push({type:type,message:message}),$timeout(function(){messaging.publish(messages.topic._ERROR_NOTIFICATION_UPDATED_,_notifications)},100)};messaging.subscribe(messages.topic._ADD_NOTIFICATION_,_addNotification);var _clearNotification=function(){init()};messaging.subscribe(messages.topic._CLEAR_NOTIFICATIONS_,_clearNotification);var init=function(){_notifications=[]},api={init:init};return api}])}(),function(){"use strict";angular.module("core.services").factory("SpinnerFactory",[function(){var _isLoading=!1;return{isLoading:_isLoading}}])}(),function(){angular.module("app.authentication",["authentication.controllers","authentication.services"])}(),function(){"use strict";angular.module("authentication.controllers",[])}(),function(){"use strict";angular.module("authentication.controllers").controller("EmailVerificationByTokenController",["$scope","$routeParams","$location","$controller","MESSAGES","URLS",function($scope,$routeParams,$location,$controller,MESSAGES,URLS){var messages=MESSAGES,_self=this;$controller("BaseController",{$scope:$scope});var _onGetEmailVerificationByTokenComplete=function(model){_self.email=model.email},_onUpdateEmailVerificationByTokenComplete=function(){$location.path(URLS.path._HOME_)};this.submit=function(valid){if(valid){var data={token:_self.token,is_confirmed:!0};$scope.publish(messages.topic._UPDATE_EMAIL_VERIFICATION_BY_TOKEN_,[data])}},this.home_url=function(){$location.path(URLS.path._HOME_)};var init=function(){_self.token=$routeParams.token,_self.user=$scope.auth.getUser(),$scope.subscribe(messages.topic._GET_EMAIL_VERIFICATION_BY_TOKEN_COMPLETE_,_onGetEmailVerificationByTokenComplete),$scope.subscribe(messages.topic._UPDATE_EMAIL_VERIFICATION_BY_TOKEN_COMPLETE_,_onUpdateEmailVerificationByTokenComplete),$scope.publish(messages.topic._GET_EMAIL_VERIFICATION_BY_TOKEN_,[_self.token])};init()}])}(),function(){"use strict";angular.module("authentication.controllers").controller("LoginController",["$scope","$location","$controller","MESSAGES","URLS",function($scope,$location,$controller,MESSAGES,URLS){var messages=MESSAGES,_self=this;$controller("BaseController",{$scope:$scope});var _onAuthenticationCompleted=function(user){$scope.publish(messages.topic._ADD_NOTIFICATION_,["Hi "+user.getShortName()+". Welcome back!","info"]);var searchObj=$location.search();searchObj.redirectTo?$location.path(searchObj.redirectTo).search({}):$location.path(URLS.path._DASHBOARD_)},_onAuthenticationFailed=function(){console.log("_onAuthenticationFailed")};this.submit=function(valid){if(valid){var data={email:_self.email,password:_self.password};$scope.publish(messages.topic._LOGIN_USER_,[data])}},this.loginFacebook=function(){$scope.publish(messages.topic._FACEBOOK_SIGNIN_)},this.loginGPlus=function(){$scope.publish(messages.topic._GPLUS_SIGNIN_)},this.signup_url=function(){$location.path(URLS.path._SIGNUP_)},this.forgot_password_url=function(){$location.path(URLS.path._RESET_PASSWORD_)};var _init=function(){$scope.subscribe(messages.topic._AUTHENTICATION_COMPLETED_,_onAuthenticationCompleted),$scope.subscribe(messages.topic._AUTHENTICATION_FAILED_,_onAuthenticationFailed)};_init()}])}(),function(){"use strict";angular.module("authentication.controllers").controller("ResetPasswordConfirmationController",["$scope","$routeParams","$location","$controller","MESSAGES","URLS",function($scope,$routeParams,$location,$controller,MESSAGES,URLS){var messages=MESSAGES,_self=this;$controller("BaseController",{$scope:$scope});var _onResetPasswordConfirmationComplete=function(){$location.path(URLS.path._LOGIN_)};this.submit=function(valid){if(valid){var data={email:_self.email,password:_self.password,key_url:_self.key_url,token:_self.token};$scope.publish(messages.topic._RESET_PASSWORD_CONFIRMATION_,[data])}},this.login_url=function(){$location.path(URLS.path._LOGIN_)};var init=function(){_self.key_url=$routeParams.key_url,_self.token=$routeParams.token,$scope.subscribe(messages.topic._RESET_PASSWORD_CONFIRMATION_COMPLETE_,_onResetPasswordConfirmationComplete)};init()}])}(),function(){"use strict";angular.module("authentication.controllers").controller("ResetPasswordController",["$scope","$location","$controller","MESSAGES","URLS",function($scope,$location,$controller,MESSAGES,URLS){var messages=MESSAGES,_self=this;$controller("BaseController",{$scope:$scope});var _onResetPasswordComplete=function(){$location.path(URLS.path._HOME_)};this.submit=function(valid){if(valid){var data={email:_self.email};$scope.publish(messages.topic._RESET_PASSWORD_,[data])}},this.login_url=function(){$location.path(URLS.path._LOGIN_)};var init=function(){$scope.subscribe(messages.topic._RESET_PASSWORD_COMPLETE_,_onResetPasswordComplete)};init()}])}(),function(){"use strict";angular.module("authentication.controllers").controller("SignupController",["$scope","$location","$controller","MESSAGES","URLS",function($scope,$location,$controller,MESSAGES,URLS){var messages=MESSAGES,_self=this;$controller("BaseController",{$scope:$scope});var _onAuthenticationCompleted=function(user){$scope.publish(messages.topic._ADD_NOTIFICATION_,["Hi "+user.getShortName()+". Good to know you have join in. You are welcome!","info"]);var searchObj=$location.search();searchObj.redirectTo?$location.path(searchObj.redirectTo).search({}):$location.path(URLS.path._DASHBOARD_)},_onAuthenticationFailed=function(){console.log("_onAuthenticationFailed")};this.submit=function(valid){if(valid){var data={username:_self.username,email:_self.email,password:_self.password};$scope.publish(messages.topic._SIGNUP_USER_,[data])}},this.login_url=function(){$location.path(URLS.path._LOGIN_)};var _init=function(){$scope.subscribe(messages.topic._AUTHENTICATION_COMPLETED_,_onAuthenticationCompleted),$scope.subscribe(messages.topic._AUTHENTICATION_FAILED_,_onAuthenticationFailed)};_init()}])}(),function(){"use strict";angular.module("authentication.services",[])}(),function(){"use strict";angular.module("app").run(["AuthFactory",function(AuthFactory){AuthFactory.init()}]),angular.module("app").run(["$rootScope","$state","$location","$injector","$http","AuthFactory",function($rootScope,$state,$location,$injector,$http,AuthFactory){var auth=AuthFactory;$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){console.log("$stateChangeStart",event,toState,toParams,fromState,fromParams);var user=auth.getUser();if(console.log(!user.isAuthorized(toState.access_level)),!user.isAuthorized(toState.access_level))if(console.log("user.isLoggedIn()",user.isLoggedIn()),user.isLoggedIn())console.log("The user do not have permissions to view the view"),event.preventDefault();else{var redirectTo=$location.url();$state.go("login",{redirectTo:redirectTo}),event.preventDefault()}}),$rootScope.$on("$stateNotFound",function(event,unfoundState,fromState,fromParams){console.log("$stateNotFound",event,unfoundState,fromState,fromParams)}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){console.log("$stateChangeSuccess",event,toState,toParams,fromState,fromParams)}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){console.log("$stateChangeError",event,toState,toParams,fromState,fromParams,error)}),$injector.get("$http").defaults.transformRequest=function(data,headersFn){var user=auth.getUser();if(user.isLoggedIn()){var token=user.getToken();token&&(headersFn().Authorization="Token "+token)}return data?angular.toJson(data):void 0}}])}(),function(){"use strict";angular.module("authentication.services").factory("AuthFactory",["$cookieStore","$http","MessagingFactory","MESSAGES","ACCESS_LEVELS","URLS","ModelTransformerFactory","UserModel",function($cookieStore,$http,MessagingFactory,MESSAGES,ACCESS_LEVELS,URLS,ModelTransformerFactory,UserModel){var messaging=MessagingFactory,messages=MESSAGES,modelTransformer=ModelTransformerFactory,_user=null,_setUser=function(user){(!user.role||user.role<0)&&(user.role=ACCESS_LEVELS.user),_user=user,$cookieStore.put("user",_user)},_getTokenFromAuthorizationHeader=function(header){var t=header.split(" ");return 2==t.length&&"Token"===t[0]?t[1]:void 0},_resetCookies=function(){$cookieStore.remove("user")},_onLogin=function(data){return $http({method:"post",url:URLS.api._LOGIN_,data:data}).success(_onLoginSuccess).error(_onLoginFailure)},_onLoginSuccess=function(response,status,headerFn){var user=modelTransformer.transform(response,UserModel);if(headerFn().authorization){var token=_getTokenFromAuthorizationHeader(headerFn().authorization);user.setToken(token)}messaging.publish(messages.topic._LOGIN_USER_COMPLETE_,[user])},_onLoginFailure=function(response){messaging.publish(messages.topic._LOGIN_USER_FAILED_)};messaging.subscribe(messages.topic._LOGIN_USER_,_onLogin);var _onSignup=function(data){return $http({method:"post",url:URLS.api._SIGNUP_,data:data}).success(_onSignupSuccess).error(_onSignupFailure)},_onSignupSuccess=function(response,status,headerFn){var user=modelTransformer.transform(response,UserModel);if(headerFn().authorization){var token=_getTokenFromAuthorizationHeader(headerFn().authorization);user.setToken(token)}messaging.publish(messages.topic._SIGNUP_USER_COMPLETE_,[user])},_onSignupFailure=function(response){messaging.publish(messages.topic._SIGNUP_USER_FAILED_)};messaging.subscribe(messages.topic._SIGNUP_USER_,_onSignup);var _onLogout=function(){return $http({method:"post",url:URLS.api._LOGOUT_}).success(_onLogoutSuccess).error(_onLogoutFailure)},_onLogoutSuccess=function(response,status,headerFn){_resetCookies(),init(),messaging.publish(messages.topic._LOGOUT_USER_COMPLETE_)},_onLogoutFailure=function(response){messaging.publish(messages.topic._LOGOUT_USER_FAILED_)};messaging.subscribe(messages.topic._LOGOUT_USER_,_onLogout);var _onAuthenticationCompleted=function(user){_setUser(user),messaging.publish(messages.topic._AUTHENTICATION_COMPLETED_,[_user])};messaging.subscribe(messages.topic._LOGIN_USER_COMPLETE_,_onAuthenticationCompleted),messaging.subscribe(messages.topic._SIGNUP_USER_COMPLETE_,_onAuthenticationCompleted),messaging.subscribe(messages.topic._COOKIES_SIGNIN_COMPLETED_,_onAuthenticationCompleted);var _onCookiesSignin=function(){var user_cookie=$cookieStore.get("user"),user=modelTransformer.transform(user_cookie,UserModel);if(user.key_url&&user.getToken()){var header={};header.Authorization="Token "+user.getToken(),messaging.publish(messages.topic._COOKIES_SIGNIN_COMPLETED_,[user])}};messaging.subscribe(messages.topic._COOKIES_SIGNIN_,_onCookiesSignin);var _onCookiesSigninFailed=function(){_resetCookies()};messaging.subscribe(messages.topic._COOKIES_SIGNIN_FAILED_,_onCookiesSigninFailed);var getUser=function(){return _user||new UserModel},init=function(){_user=new UserModel,messaging.publish(messages.topic._COOKIES_SIGNIN_)},api={init:init,getUser:getUser};return api}])}(),function(){"use strict";angular.module("authentication.services").factory("ResetPasswordFactory",["MessagingFactory","MESSAGES","URLS","ResetPasswordResourceFactory","ModelTransformerFactory","UserModel",function(MessagingFactory,MESSAGES,URLS,ResetPasswordResourceFactory,ModelTransformerFactory,UserModel){var messaging=MessagingFactory,messages=MESSAGES,resetPasswordResource=ResetPasswordResourceFactory,modelTransformer=ModelTransformerFactory,_resetPassword=function(data){return resetPasswordResource.create(data,_resetPasswordSuccess,_resetPasswordFailure)},_resetPasswordSuccess=function(response,headerFn){messaging.publish(messages.topic._RESET_PASSWORD_COMPLETE_)},_resetPasswordFailure=function(response){messaging.publish(messages.topic._RESET_PASSWORD_FAILED_)};messaging.subscribe(messages.topic._RESET_PASSWORD_,_resetPassword);var _getResetPassword=function(key_url){return resetPasswordResource.get({key_url:key_url},_getResetPasswordSuccess,_getResetPasswordFailure)},_getResetPasswordSuccess=function(response,headerFn){response?messaging.publish(messages.topic._GET_RESET_PASSWORD_COMPLETE_,[modelTransformer.transform(response,UserModel)]):_getResetPasswordFailure()},_getResetPasswordFailure=function(response){messaging.publish(messages.topic._GET_RESET_PASSWORD_FAILED_)};messaging.subscribe(messages.topic._GET_RESET_PASSWORD_,_getResetPassword);var _resetPasswordConfirmation=function(data){return resetPasswordResource.update(data,_resetPasswordConfirmationSuccess,_resetPasswordConfirmationFailure)},_resetPasswordConfirmationSuccess=function(response,headerFn){messaging.publish(messages.topic._RESET_PASSWORD_CONFIRMATION_COMPLETE_)},_resetPasswordConfirmationFailure=function(response){messaging.publish(messages.topic._RESET_PASSWORD_CONFIRMATION_FAILED_)};messaging.subscribe(messages.topic._RESET_PASSWORD_CONFIRMATION_,_resetPasswordConfirmation);var init=function(){};return{init:init}}])}(),function(){"use strict";angular.module("authentication.services").factory("ResetPasswordResourceFactory",["$resource","URLS",function($resource,URLS){return $resource(URLS.api._RESET_PASSWORD_,{key_url:"@key_url"},{create:{method:"POST"},get:{method:"GET",isArray:!1},update:{method:"PUT"}})}])}(),function(){"use strict";var UserModel=function(){var _self=this;_self.key_url=null,_self.username=null,_self.email=null,_self.token=null,_self.role=""};UserModel.prototype={setToken:function(token){token=token||null,this.token=token},getToken:function(){return this.token},isAuthorized:function(level){return level?level>1?this.username?this.role>=level:!1:!0:!1},getShortName:function(){return this.first_name?this.first_name:this.username},getFullName:function(){return this.first_name&&this.last_name?this.first_name+" "+this.last_name:null},isLoggedIn:function(){return this.username?!0:!1},getUsername:function(){return this.username},getKeyUrl:function(){return this.key_url}},angular.module("authentication.services").value("UserModel",UserModel)}();